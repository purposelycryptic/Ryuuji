<!DOCTYPE html>
<html>
	<head>
	<title id="PlexSeriesInfo">Ryuuji</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="refresh" content="120">
	<link rel="stylesheet" href="/web/style.css">
	<link rel="shortcut icon" href="/web/favicon.ico">
	<link rel="mask-icon" href="/web/favicon-mask.svg" color="#cc7b19">	
	</head>
<body>

<div class="PlexContainer">
  <img id="PlexSeriesThumbnail" class="PlexThumb" src="/web/plex.gif" alt="Ooops...">
  <div class="PlexContent">
    <h2 id="PlexSeriesTitle" style="color:#e5a00d">Loading...</h2>
	<h3 id="PlexSeriesStatus"></h3>
    <p id="PlexSeriesEpisode"></p>
    <p id="PlexSeriesSynopsis"></p> 
  </div>
</div>
  
<script>
var succ = false;
var xhttp = new XMLHttpRequest();
xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
        myFunction(this);

    }
};
setInterval(function() {
  xhttp.open("GET", "http://[IP_ADDRESS]:[PLEX_PORT]/status/sessions/?X-Plex-Token=[X_PLEX_TOKEN]", true);
  xhttp.send();
},5000);

function myFunction(xml) {
      var xmlDoc = xml.responseXML;
      var x = xmlDoc.getElementsByTagName('Video');
      for (i = 0; i < x.length ; i++){
      var z = x[i].childNodes[8];
      console.log(z);
          var token = "/?X-Plex-Token=[X_PLEX_TOKEN]"
		  var series = x[i].getAttributeNode("grandparentTitle");
          var episode = x[i].getAttributeNode("index");
		  var season = x[i].getAttributeNode("parentIndex");
          var name = x[i].getAttributeNode("title");
		  var sum = x[i].getAttributeNode("summary");
		  var thumbnail = x[i].getAttributeNode("thumb");
		  var y = x[i].getElementsByTagName('Player');
		  for (j = 0; j < y.length ; j++){
		  var state = y[j].getAttributeNode("state");
		  var playerIP = y[j].getAttributeNode("remotePublicAddress")}
		  var player = "http://[IP_ADDRESS]:[PLEX_PORT]";
		  var thumbloc = player + thumbnail.nodeValue + ".png"+ token;
		  
          document.getElementById("PlexSeriesInfo").innerHTML = series.nodeValue + " - Episode " + episode.nodeValue + " - " + state.nodeValue;

		  
		  document.getElementById("PlexSeriesThumbnail").src = thumbloc;
		  document.getElementById("PlexSeriesTitle").innerHTML = series.nodeValue + "<span style=\"color:white;font-weight:300\">" + " Season " + season.nodeValue + "</span>";
		  document.getElementById("PlexSeriesEpisode").innerHTML = "<span style=\"font-weight:bold\">" + "Episode " + episode.nodeValue + "</br>" + "</span>" + name.nodeValue;
		  document.getElementById("PlexSeriesStatus").innerHTML = "Currently " + state.nodeValue;
		  document.getElementById("PlexSeriesSynopsis").innerHTML = "<span style=\"font-weight:bold\">" + "Synopsis" + "</span>" + "</br>" + sum.nodeValue;
		  
        
     }
}

</script>
</body>
</html>
